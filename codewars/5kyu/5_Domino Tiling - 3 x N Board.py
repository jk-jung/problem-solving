# 0: ###
# 1: ##_
# 2: _##
# 3: ___
# 4: #__
# 5: __#

def three_by_n(n):
    a = [0 for _ in range(16)]
    a[0] = 1

    for i in range(n):
        b = [0 for _ in range(16)]
        b[0] = (a[1] + a[2] + a[3]) % 12345787
        b[1] = (a[0] + a[5]) % 12345787
        b[2] = (a[0] + a[4]) % 12345787
        b[3] = (a[0]) % 12345787
        b[4] = (a[2]) % 12345787
        b[5] = (a[1]) % 12345787

        b[6 + 0] = (a[6 + 1] + a[6 + 2] + a[6 + 3]) % 12345787
        b[6 + 1] = (a[6 + 0] + a[6 + 5]) % 12345787
        b[6 + 2] = (a[6 + 0] + a[6 + 4]) % 12345787
        b[6 + 3] = (a[6 + 0]) % 12345787
        b[6 + 4] = (a[6 + 2]) % 12345787
        b[6 + 5] = (a[6 + 1]) % 12345787

        b[6 + 0] = (b[6 + 0] + b[1] + b[2]) % 12345787
        b[6 + 1] = (b[6 + 1] + b[4]) % 12345787
        b[6 + 2] = (b[6 + 2] + b[5]) % 12345787
        b[6 + 4] = (b[6 + 4] + b[3]) % 12345787
        b[6 + 5] = (b[6 + 5] + b[3]) % 12345787

        a = b
    if n % 2 == 1: return a[6]
    return a[0]
